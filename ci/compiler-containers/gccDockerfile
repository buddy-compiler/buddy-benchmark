# Use ubuntu:22.04 as a base image for compiling riscv-gnu-toolchain
FROM ubuntu:22.04 AS builder

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get install -y \
    autoconf automake autotools-dev curl python3 python3-pip libmpc-dev libmpfr-dev libgmp-dev gawk build-essential bison\
    flex texinfo gperf libtool patchutils bc zlib1g-dev libexpat-dev git ninja-build cmake libglib2.0-dev libslirp-dev && \
    rm -rf /var/lib/apt/lists/*

# Define the build parameter GCC_TAG, which is used to clone the gcc project with the specified version
# default releases/gcc-14.1.0
ARG GCC_TAG=releases/gcc-14.1.0

RUN git clone \
    -b ${GCC_TAG} \
    --depth=1 \
    https://mirrors.tuna.tsinghua.edu.cn/git/gcc.git

WORKDIR gcc

RUN ./configure --prefix=/opt/gcc -enable-checking=release -enable-languages=c,c++ -disable-multilib
RUN make
RUN make install

FROM ubuntu:22.04

ENV GCC=/opt/gcc
ENV PATH=$GCC/bin:$PATH

# 将 builder 阶段中编译好的文件复制到最终的镜像
COPY --from=builder /opt/gcc ${GCC}



