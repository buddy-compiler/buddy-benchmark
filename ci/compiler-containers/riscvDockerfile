FROM ubuntu:22.04 AS builder

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get install -y \
    autoconf automake autotools-dev curl python3 python3-pip libmpc-dev libmpfr-dev libgmp-dev gawk build-essential bison\
    flex texinfo gperf libtool patchutils bc zlib1g-dev libexpat-dev git ninja-build cmake libglib2.0-dev libslirp-dev && \
    rm -rf /var/lib/apt/lists/*

# Define the build parameter COLLAB_TAG, which defaults to 2024.04.12. 
# Used to specify the version of the RISC-V GNU toolchain
ARG COLLAB_TAG=2024.04.12

RUN git clone \
    --depth=1 \
    -b ${COLLAB_TAG} \
    https://github.com/riscv-collab/riscv-gnu-toolchain.git

WORKDIR riscv-gnu-toolchain

# Use the GCC_TAG parameter to specify a specific version of GCC (default is releases/gcc-14.1.0)
RUN git submodule update --init gcc
ARG GCC_TAG=releases/gcc-14.1.0
RUN git -C gcc remote update && git -C gcc fetch origin ${GCC_TAG} && git -C gcc checkout ${GCC_TAG}

RUN ./configure --prefix=/opt/riscv 
RUN make linux

FROM ubuntu:22.04

ENV RISCV=/opt/riscv 
ENV PATH=$RISCV/bin:$PATH

COPY --from=builder /opt/riscv ${RISCV}



